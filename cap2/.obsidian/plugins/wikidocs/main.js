/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var B=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var tt=Object.prototype.hasOwnProperty;var et=(s,t)=>{for(var e in t)B(s,e,{get:t[e],enumerable:!0})},at=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Z(t))!tt.call(s,n)&&n!==e&&B(s,n,{get:()=>t[n],enumerable:!(i=Y(t,n))||i.enumerable});return s};var nt=s=>at(B({},"__esModule",{value:!0}),s);var ot={};et(ot,{default:()=>E});module.exports=nt(ot);var d=require("obsidian");var m=require("obsidian");function g(s){return(0,m.normalizePath)(s)}function C(s){let t=s.match(/^---[\s\S]*?---\n/);return t?s.replace(t[0],"").trim():s.trim()}function F(s){let t=s.split("/");return t[t.length-1].replace(".md","")}function k(s){return new Date(s.stat.mtime)}async function R(s){let t=s;for(;t&&t.parent;){if(t instanceof m.TFolder){let e=`${t.path}/metadata.md`,i=this.app.vault.getAbstractFileByPath(e);if(i instanceof m.TFile){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter){let a={};for(let[r,o]of Object.entries(n.frontmatter))(typeof o=="string"||typeof o=="number")&&(a[r]=o);return a}}}t=t.parent}return null}async function O(s){let t=[...s.children];for(let e of t)e instanceof m.TFile&&e.name==="metadata.md"||e instanceof m.TFile&&e.extension!=="md"||await this.app.fileManager.trashFile(e)}async function S(s){this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s)}function A(s){let t=this.app.metadataCache.getFileCache(s);if(!(t!=null&&t.embeds))return[];let e=[];for(let i of t.embeds){let n=decodeURIComponent(i.link),a=this.app.metadataCache.getFirstLinkpathDest(n,s.path);a instanceof m.TFile&&a.extension.match(/jpg|jpeg|png|gif/)&&e.push(a)}return e}async function U(s){return new Promise(t=>{let e=new m.Modal(this.app);e.contentEl.createEl("h2",{text:"\uD655\uC778 \uD544\uC694"}),s.split(`
`).forEach(r=>{e.contentEl.createEl("p",{text:r})});let n=e.contentEl.createEl("button",{text:"\uD655\uC778"});n.classList.add("dialog-confirm-button"),n.addEventListener("click",()=>{e.close(),t(!0)});let a=e.contentEl.createEl("button",{text:"\uCDE8\uC18C"});a.classList.add("dialog-cancel-button"),a.addEventListener("click",()=>{e.close(),t(!1)}),e.open()})}async function T(s){let t=s;for(;t&&t.parent;){if(t instanceof m.TFolder){let e=`${t.path}/metadata.md`;if(this.app.vault.getAbstractFileByPath(e)instanceof m.TFile)return!0}t=t.parent}return!1}async function j(s){let t=s;for(;t&&t.parent;){if(t instanceof m.TFolder){let e=`${t.path}/blog_metadata.md`;if(this.app.vault.getAbstractFileByPath(e)instanceof m.TFile)return!0}t=t.parent}return!1}var z={apiBaseUrl:"https://wikidocs.net/napi",apiToken:""};var f=require("obsidian");var _=class{constructor(t){this.id=t.id,this.subject=t.subject,this.last_synced=t.last_synced,this.book_id=t.book_id,this.parent_id=t.parent_id,this.open_yn=t.open_yn,this.subject.includes("#")&&(this.subject=`"${this.subject}"`)}static fromFrontMatter(t){if(!t.id||!t.subject)throw new Error("Front Matter must contain 'id' and 'subject'.");return new _({id:t.id,subject:t.subject,last_synced:t.last_synced,book_id:t.book_id,parent_id:t.parent_id,open_yn:t.open_yn})}isLocked(){return this.open_yn==="N"}updateLastSynced(){this.last_synced=new Date().toISOString()}getFrontMatter(){var e,i;return`---
id: ${this.id}
subject: ${this.subject}
book_id: ${(e=this.book_id)!=null?e:-1}
parent_id: ${(i=this.parent_id)!=null?i:-1}
open_yn: ${this.open_yn}
last_synced: ${this.last_synced}
---
`}};async function q(s,t,e){let i=`${s}/metadata.md`,n=`---
id: ${t}
title: ${e}
---
`,a=this.app.vault.getAbstractFileByPath(i);a instanceof f.TFile?await this.app.vault.modify(a,n):a?console.error(`The path "${i}" exists but is not a valid file.`):await this.app.vault.create(i,n)}async function it(s){let t=s.parent;if(!(t instanceof f.TFolder))return-1;let e=t.parent;if(!(e instanceof f.TFolder))return-1;let i=t.name,n=`${e.path}/${i}.md`,a=s.vault.getAbstractFileByPath(n);if(!(a instanceof f.TFile)||a.extension!=="md")return-1;let r=this.app.metadataCache.getFileCache(a);if(!r||!r.frontmatter)return-1;let o=r.frontmatter;return!o.id||typeof o.id!="number"?-1:o.id}function J(s){let t=s.match(/^---[\s\S]*?---\n/);return t?s.slice(t[0].length).trim():s.trim()}async function D(s){let t=new Date().toISOString(),e=-1,i=await R(s);i&&i.id&&(e=typeof i.id=="string"?parseInt(i.id,10):i.id);let n=await it(s);await this.app.fileManager.processFrontMatter(s,a=>{a||(a={}),a.id=a.id||-1,a.subject=a.subject||g(s.basename),a.last_synced="",a.book_id=e,a.parent_id=n})}async function G(s){let t=`${s}/metadata.md`,e=this.app.vault.getAbstractFileByPath(t);if(e instanceof f.TFile){let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter&&i.frontmatter.id)return parseInt(i.frontmatter.id,10)}return null}async function $(s){let t=this.app.metadataCache.getFileCache(s);if(t!=null&&t.frontmatter)return _.fromFrontMatter(t.frontmatter);throw new Error(`No Front Matter found in file: ${s.path}`)}async function P(s,t,e){var i;for(let n of t){let a=g(n.subject),r=`${e}/${a}.md`;try{let o=new Date().toISOString(),l=new _(n);l.last_synced=o;let p=l.getFrontMatter()+((i=n.content)!=null?i:"No content available.");if(await this.app.vault.create(r,p),n.open_yn,n.children&&n.children.length>0){let u=`${e}/${a}`;await S(u),await P(s,n.children,u)}}catch(o){console.error(`Failed to save page: ${n.subject}`,o)}}}async function V(s,t){let e=this.app.vault.getFiles().filter(n=>n.path.startsWith(t.path)),i=0;for(let n of e){if(n.name==="metadata.md"||n.extension!=="md")continue;let a=await this.app.vault.read(n),r=await $(n);if(!r.id){console.error(`No ID found in Front Matter for file: ${n.path}`);continue}let o=r.last_synced?new Date(r.last_synced):null,l=k(n);(!o||l.getTime()-o.getTime()>1e3||g(r.subject)!==g(F(n.path)))&&i++}return i>0}async function H(s){var e;let t=this.app.metadataCache.getFileCache(s);if(((e=t==null?void 0:t.frontmatter)==null?void 0:e.open_yn)==="N"){let i=document.querySelector(`.nav-file-title[data-path="${s.path}"]`);if(i&&!i.querySelector(".lock-icon")){let a=document.createElement("span");a.className="lock-icon",i.appendChild(a)}}else{let i=document.querySelector(`.nav-file-title[data-path="${s.path}"]`);if(i){let n=i.querySelector(".lock-icon");n&&n.remove()}}}async function K(s){}async function L(s,t){}var w=class{constructor(t){this.id=t.id,t.tags?this.tags=t.tags:this.tags=[],this.is_public=t.is_public,this.last_synced=t.last_synced}static fromFrontMatter(t){if(!t.id)throw new Error("Front Matter must contain 'id'.");return new w({id:t.id,tags:t.tags,is_public:t.is_public,last_synced:t.last_synced})}getFrontMatter(){return`---
id: ${this.id}
tags: ${this.tags}
is_public: ${this.is_public}
last_synced: ${this.last_synced}
---
`}};async function Q(s,t,e){var a;let i=g(t.title),n=`${e}/${i}.md`;try{let r=new Date().toISOString(),o=new w(t);o.last_synced=r;let c=o.getFrontMatter()+((a=t.content)!=null?a:"No content available."),p=this.app.vault.getAbstractFileByPath(n);p instanceof f.TFile?await this.app.vault.modify(p,c):p=await this.app.vault.create(n,c),await L(n,t),await this.app.workspace.getLeaf(!1).openFile(p)}catch(r){console.error(`Failed to save blog: ${t.title}`,r)}}async function X(s){let t=new Date().toISOString();await this.app.fileManager.processFrontMatter(s,e=>{e||(e={}),e.id=e.id||-1,e.tags="",e.is_public=!0,e.last_synced=""})}async function I(s){let t=this.app.metadataCache.getFileCache(s);if(t!=null&&t.frontmatter)return w.fromFrontMatter(t.frontmatter);throw new Error(`No Front Matter found in file: ${s.path}`)}var N=require("obsidian"),M=class{constructor(t){this.settings=t}async fetchWithAuth(t,e={}){let i=this.settings.apiToken;if(!i)throw new Error("API token is not set. Please configure the plugin.");let n=this.settings.apiBaseUrl.replace(/\/+$/,""),a=t.replace(/^\/+/,""),r=`${n}/${a}`,o={...e.headers,Authorization:`Token ${i}`};return fetch(r,{...e,headers:o})}async updatePageOnServer(t,e){let i={id:t.id,book_id:t.book_id,parent_id:t.parent_id,subject:t.subject,content:e.trim(),open_yn:t.open_yn},n=await this.fetchWithAuth(`/pages/${t.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(n.ok)return(await n.json()).id;{let a=await n.text();return console.error(`Failed to update page ${t.id}: ${a}`),-1}}async uploadImagesForPage(t,e,i){let n={};for(let a of i){let r=await t.vault.readBinary(a),o=new FormData;o.append("file",new Blob([r]),a.name),o.append("page_id",e.toString());let l=await this.fetchWithAuth("/images/upload/",{method:"POST",body:o});if(!l.ok)throw new Error(`Failed to upload image: ${a.name}`);let c=await l.json();n[a.path]=c.url}return n}async uploadImagesForBlog(t,e,i){let n={};for(let a of i){let r=await t.vault.readBinary(a),o=new FormData;o.append("file",new Blob([r]),a.name),o.append("blog_id",e.toString());let l=await this.fetchWithAuth("/blog/images/upload/",{method:"POST",body:o});if(!l.ok)throw new Error(`Failed to upload image: ${a.name}`);let c=await l.json();n[a.path]=c.url}return n}async downloadBook(t,e){let i=await this.fetchWithAuth(`/books/${e}/`);if(!i.ok){new N.Notice("\uCC45 \uB0B4\uB824\uBC1B\uAE30\uAC00 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.");return}let n=await i.json(),a=g(n.subject);await S(a),await q(a,e,n.subject),await P(t,n.pages,a),new N.Notice(`"${n.subject}" \uCC45\uC744 \uC131\uACF5\uC801\uC73C\uB85C \uB0B4\uB824\uBC1B\uC558\uC2B5\uB2C8\uB2E4!`)}};var E=class extends d.Plugin{async onload(){await this.loadSettings(),this.apiClient=new M(this.settings);let e=!1,i=!1;this.addRibbonIcon("book","\uC704\uD0A4\uB3C5\uC2A4 \uCC45 \uBAA9\uB85D \uAC00\uC838\uC624\uAE30",async a=>{let r=await this.promptForBookSelection();r&&(e=!0,await this.apiClient.downloadBook(this.app,r),e=!1)}),this.addRibbonIcon("rss","\uC704\uD0A4\uB3C5\uC2A4 \uBE14\uB85C\uADF8 \uAC00\uC838\uC624\uAE30",async a=>{await this.promptForBlogSelection()?new d.Notice("\uBE14\uB85C\uADF8\uB97C \uC131\uACF5\uC801\uC73C\uB85C \uAC00\uC838\uC654\uC2B5\uB2C8\uB2E4."):new d.Notice("\uBE14\uB85C\uADF8\uB97C \uAC00\uC838\uC624\uAE30\uB97C \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.")}),this.addCommand({id:"fetch-selected-book",name:"\uC704\uD0A4\uB3C5\uC2A4 \uCC45 \uBAA9\uB85D \uAC00\uC838\uC624\uAE30",callback:async()=>{let a=await this.promptForBookSelection();a&&(e=!0,await this.apiClient.downloadBook(this.app,a),e=!1)}}),this.registerEvent(this.app.workspace.on("file-menu",async(a,r)=>{if(r instanceof d.TFolder){let o=`${r.path}/metadata.md`;this.app.vault.getAbstractFileByPath(o)instanceof d.TFile&&(a.addItem(c=>{c.setTitle("\uC704\uD0A4\uB3C5\uC2A4 \uB0B4\uB824\uBC1B\uAE30").setIcon("cloud-download").onClick(async()=>{await V(this.app,r)?await U(`[\uC8FC\uC758!!] \uBCC0\uACBD\uB41C \uD398\uC774\uC9C0\uAC00 \uC788\uC2B5\uB2C8\uB2E4. 
\uBCC0\uACBD\uB41C \uD398\uC774\uC9C0\uB97C \uBA3C\uC800 '\uC704\uD0A4\uB3C5\uC2A4 \uBCF4\uB0B4\uAE30'\uB85C \uC804\uC1A1\uD574 \uC8FC\uC138\uC694.
\uBB34\uC2DC\uD558\uACE0 \uB0B4\uB824\uBC1B\uC73C\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`)&&(e=!0,await this.syncFromServer(r),e=!1):(e=!0,await this.syncFromServer(r),e=!1)})}),a.addItem(c=>{c.setTitle("\uC704\uD0A4\uB3C5\uC2A4 \uBCF4\uB0B4\uAE30").setIcon("cloud-upload").onClick(async()=>{e=!0,await this.syncToServer(r),e=!1})}))}if(r instanceof d.TFolder){let o=`${r.path}/blog_metadata.md`;this.app.vault.getAbstractFileByPath(o)instanceof d.TFile&&a.addItem(c=>{c.setTitle("\uBE14\uB85C\uADF8 \uBAA9\uB85D\uC870\uD68C").setIcon("cloud-download").onClick(async()=>{let p=await this.promptForBlogListSelection();if(p==null)return null;let u=await this.apiClient.fetchWithAuth(`/blog/${p}`);if(!u.ok)return new d.Notice("\uBE14\uB85C\uADF8\uB97C \uAC00\uC838\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4."),null;let h=await u.json();r.parent instanceof d.TFolder&&Q(this.app,h,r.name)})})}if(r instanceof d.TFile&&r.parent){let o=`${r.parent.path}/blog_metadata.md`,l=this.app.vault.getAbstractFileByPath(o);l instanceof d.TFile&&r!=l&&(a.addItem(c=>{c.setTitle("\uBE14\uB85C\uADF8 \uBCF4\uB0B4\uAE30").onClick(async()=>{await this.blog_post(r)})}),a.addItem(c=>{c.setTitle("\uBE14\uB85C\uADF8 \uB0B4\uB824\uBC1B\uAE30").onClick(async()=>{if(r.name==="blog_metadata.md")return;let p=await I(r);if(!p.id||p.id==-1){console.error(`No ID found in Front Matter for file: ${r.path}`);return}let u=p.id;this.blog_update(r,u)})}))}})),this.app.workspace.onLayoutReady(()=>{i=!0}),this.registerEvent(this.app.vault.on("create",async a=>{if(i&&!e&&a instanceof d.TFile&&a.extension==="md"){let r=await this.app.vault.read(a);if(r.trim()==="")await T(a)&&await D(a),await j(a)&&await X(a);else{if(a.name==="metadata.md"||a.name==="blog_metadata.md")return;await new Promise(l=>setTimeout(l,100));let o;if(await T(a)&&(o=await $(a)),await j(a)&&(o=await I(a)),o&&o.last_synced){let l=new Date,c=new Date(o.last_synced);if(Math.floor((l.getTime()-c.getTime())/1e3)>1){o.id=-1,o.last_synced="";let h=o.getFrontMatter()+J(r);await this.app.vault.modify(a,h)}}}}}));let n=new Set;this.registerEvent(this.app.vault.on("rename",async(a,r)=>{if(await T(a)){if(a instanceof d.TFolder)new d.Notice("\uD3F4\uB354\uBA85 \uBCC0\uACBD\uC740 \uC704\uD0A4\uB3C5\uC2A4\uC5D0 \uBC18\uC601\uB418\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4."),n.add(a.path),setTimeout(()=>{n.delete(a.path)},1e3);else if(a instanceof d.TFile&&a.parent){if(n.has(a.parent.path))return;a.extension==="md"&&a.name!=="metadata.md"&&D(a)}}})),this.registerEvent(this.app.workspace.on("file-open",async a=>{a instanceof d.TFile&&await T(a)&&H(a)})),this.addSettingTab(new W(this.app,this))}async onunload(){}async syncFromServer(e){let i=e.name;try{let n=await G(e.path);if(!n){new d.Notice("\uCC45\uC758 \uBA54\uD0C0\uB370\uC774\uD130\uAC00 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return}let a=await this.apiClient.fetchWithAuth(`/books/${n}/`);if(!a.ok){new d.Notice("\uCC45 \uB0B4\uB824\uBC1B\uAE30\uAC00 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.");return}await O(e);let r=await a.json();await P(this.app,r.pages,e.path),new d.Notice(`"${r.subject}" \uCC45\uC744 \uC131\uACF5\uC801\uC73C\uB85C \uB0B4\uB824\uBC1B\uC558\uC2B5\uB2C8\uB2E4.`)}catch(n){console.error(`Failed to sync folder "${i}"`,n),new d.Notice("\uCC45 \uB0B4\uB824\uBC1B\uAE30\uAC00 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.")}}async syncToServer(e){let i=e.name,n=this.app.vault.getFiles().filter(o=>o.path.startsWith(e.path)),a=0,r=!1;for(let o of n)try{if(o.name==="metadata.md"||o.extension!=="md")continue;let l=await this.app.vault.read(o),c=await $(o);if(!c.id){console.error(`No ID found in Front Matter for file: ${o.path}`);continue}(c.parent_id===null||typeof c.parent_id=="string"&&c.parent_id==="null")&&(c.parent_id=-1);let p=c.last_synced?new Date(c.last_synced):null,u=k(o);if(!p||u.getTime()-p.getTime()>1e3||g(c.subject)!==g(F(o.path))){a++;let v=C(l),y=A(o);c.id!=-1&&await this.apiClient.uploadImagesForPage(this.app,c.id,y),c.subject=F(o.path);let b=await this.apiClient.updatePageOnServer(c,v);c.id==-1&&(c.id=b,await this.apiClient.uploadImagesForPage(this.app,b,y),await this.apiClient.updatePageOnServer(c,v)),new d.Notice(`${o.name} \uD398\uC774\uC9C0\uB97C \uC131\uACF5\uC801\uC73C\uB85C \uB0B4\uBCF4\uB0C8\uC2B5\uB2C8\uB2E4!`)}}catch(l){r=!0,console.error(`Failed to sync file to server: ${o.path}`,l)}!r&&a>0?await this.syncFromServer(e):new d.Notice("\uBCC0\uACBD\uB41C \uD398\uC774\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.")}async promptForBookSelection(){let e=await this.apiClient.fetchWithAuth("/books/");if(!e.ok)return new d.Notice("\uCC45 \uBAA9\uB85D\uC744 \uAC00\uC838\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4."),null;let i=await e.json();return new Promise(n=>{let a=new d.Modal(this.app);a.onClose=()=>n(null),a.contentEl.createEl("h2",{text:"\uC704\uD0A4\uB3C5\uC2A4 \uCC45\uC744 \uC120\uD0DD\uD574 \uC8FC\uC138\uC694."}).classList.add("book-selection-header");let o=a.contentEl.createEl("ul");o.classList.add("book-selection-list"),i.forEach(l=>{let c=o.createEl("li",{text:l.subject});c.classList.add("book-selection-list-item"),c.addEventListener("click",()=>{n(l.id),a.close()})}),i.length===0&&o.createEl("li",{text:"\uCC45 \uBAA9\uB85D\uC774 \uBE44\uC5B4 \uC788\uC2B5\uB2C8\uB2E4."}).classList.add("book-selection-empty-message"),a.open()})}async promptForBlogSelection(){if(window.confirm("\uBE14\uB85C\uADF8\uB97C \uAC00\uC838\uC624\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){let i=await this.apiClient.fetchWithAuth("/blog/profile/");if(i.ok){let n=await i.json();if(!this.app.vault.getAbstractFileByPath(n.name))await this.app.vault.createFolder(n.name),K(n.name);else return new d.Notice("\uBE14\uB85C\uADF8 \uD3F4\uB354\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4."),null;let a=`${n.name}/blog_metadata.md`,r=`---
id: ${n.id}
url: ${n.url}
name: ${n.name}
---
`;return await this.app.vault.create(a,r),n.id}}return null}async promptForBlogListSelection(){let e=1,i=!0;return new Promise(n=>{let a=new d.Modal(this.app);a.onClose=()=>n(null),a.contentEl.createEl("h2",{text:"\uBE14\uB85C\uADF8\uB97C \uC120\uD0DD\uD574 \uC8FC\uC138\uC694."}).classList.add("book-selection-header");let o=a.contentEl.createEl("ul");o.classList.add("book-selection-list");let l=a.contentEl.createEl("div");l.classList.add("load-more-container"),l.style.textAlign="center",l.style.marginTop="10px";let c=async u=>{let h=await this.apiClient.fetchWithAuth(`/blog/list/${u}`);if(!h.ok)return new d.Notice("\uB354 \uC774\uC0C1 \uAC00\uC838\uC62C \uBE14\uB85C\uADF8 \uBAA9\uB85D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."),!1;let y=(await h.json()).blog_pages;return i=y.length>0,y.forEach(b=>{let x=o.createEl("li"),st=x.createEl("span",{text:b.is_public?"\u{1F310} ":"\u{1F512} "});x.appendChild(document.createTextNode(b.title)),x.classList.add("book-selection-list-item"),x.addEventListener("click",()=>{n(b.id),a.close()})}),p(),y.length>0},p=()=>{if(l.empty(),i){let u=l.createEl("button",{text:"\uB354 \uBCF4\uAE30"});u.classList.add("load-more-button"),u.style.padding="5px 15px",u.style.cursor="pointer",u.addEventListener("click",async()=>{e++,await c(e)||(i=!1,p())})}else e>1&&l.createEl("span",{text:"\uB9C8\uC9C0\uB9C9 \uD398\uC774\uC9C0\uC785\uB2C8\uB2E4."})};(async()=>!await c(e)&&e===1&&(o.createEl("li",{text:"\uC791\uC131\uB41C \uBE14\uB85C\uADF8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."}).classList.add("book-selection-empty-message"),i=!1,p()))(),a.open()})}async blog_post(e){try{if(e.name==="blog_metadata.md")return;let i=await this.app.vault.read(e),n=await I(e);if(!n.id){console.error(`No ID found in Front Matter for file: ${e.path}`);return}let a=n.last_synced?new Date(n.last_synced):null,r=k(e),o=-1;if(n.id==-1){let h=await this.apiClient.fetchWithAuth("/blog/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(h.ok)o=(await h.json()).id;else{console.error("Failed to create blog");return}}else o=n.id;let l=A(e);if(l){let h=await this.apiClient.uploadImagesForBlog(this.app,o,l)}let c=F(e.path),p=C(i);try{n.tags=n.tags.join(",")}catch(h){}let u=await this.apiClient.fetchWithAuth(`/blog/${o}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:c,content:p,is_public:n.is_public,tags:n.tags})});if(u.ok){let h=await u.json();new d.Notice(`${e.name} \uBE14\uB85C\uADF8\uB97C \uC131\uACF5\uC801\uC73C\uB85C \uB0B4\uBCF4\uB0C8\uC2B5\uB2C8\uB2E4!`),this.blog_update(e,o)}else{console.error("Failed to create blog");return}}catch(i){console.error(`\uBE14\uB85C\uADF8 \uD3EC\uC2A4\uD305\uC744 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.: ${e.path}`,i)}}async blog_update(e,i){var n;try{let a=await this.apiClient.fetchWithAuth(`/blog/${i}`);if(!a.ok){console.error("\uBE14\uB85C\uADF8 \uAC00\uC838\uC624\uAE30 \uC2E4\uD328.");return}let r=await a.json(),o=new w(r),l=new Date().toISOString();o.last_synced=l;let p=o.getFrontMatter()+((n=r.content)!=null?n:"No content available.");if(e.parent){let u=g(r.title);await this.app.vault.rename(e,`${e.parent.name}/${u}.md`),await this.app.vault.modify(e,p),await L(`${e.parent.name}/${u}.md`,r)}new d.Notice("\uBE14\uB85C\uADF8\uB97C \uC131\uACF5\uC801\uC73C\uB85C \uAC00\uC838\uC654\uC2B5\uB2C8\uB2E4.")}catch(a){console.error(`\uBE14\uB85C\uADF8 \uAC00\uC838\uC624\uAE30\uB97C \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.: ${e.path}`,a)}}async loadSettings(){this.settings=Object.assign({},z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},W=class extends d.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}display(){let{containerEl:e}=this;e.empty(),new d.Setting(e).setName("API Base URL").setDesc("API\uC758 \uAE30\uBCF8 URL\uC744 \uC124\uC815\uD569\uB2C8\uB2E4.").addText(i=>{i.setPlaceholder("https://wikidocs.net/napi").setValue(this.plugin.settings.apiBaseUrl).onChange(async n=>{this.plugin.settings.apiBaseUrl=n,await this.plugin.saveSettings()}),i.inputEl.classList.add("plugin-setting-input")}),new d.Setting(e).setName("API Token").setDesc("API \uC778\uC99D \uD1A0\uD070\uC744 \uC785\uB825\uD569\uB2C8\uB2E4.").addText(i=>{i.setPlaceholder("\uC704\uD0A4\uB3C5\uC2A4\uC5D0\uC11C \uBC1C\uAE09\uD55C \uD1A0\uD070\uC744 \uC785\uB825\uD574 \uC8FC\uC138\uC694.").setValue(this.plugin.settings.apiToken).onChange(async n=>{this.plugin.settings.apiToken=n,await this.plugin.saveSettings()}),i.inputEl.classList.add("plugin-setting-input")})}};

/* nosourcemap */